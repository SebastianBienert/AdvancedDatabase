UPDATE INVOICE
SET
    Total = (Total + 2)
WHERE
    INVOICEID IN (
     SELECT i.INVOICEID
        FROM (SELECT * FROM INVOICE WHERE INVOICEDATE < DATE '2012-01-01') i
        JOIN INVOICELINE il on il.INVOICEID = i.INVOICEID
        GROUP BY i.INVOICEID
        HAVING SUM(il.QUANTITY) > 3
    );